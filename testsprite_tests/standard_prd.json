{
  "meta": {
    "project": "Rocket Chat Simulator",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "Web app for streamers to practice with an AI-driven simulated audience (Twitch/Kick themes). Users generate phrases for games or Just Chatting topics, then stream them via SSE into a virtualized chat window.",
  "core_goals": [
    "Enable streamers to generate realistic chat phrases (games and Just Chatting) using server-side AI and stream them via SSE to a virtualized chat window.",
    "Support Twitch and Kick platform themes, persistent user preferences, and Clerk-based authentication for per-user data.",
    "Provide simple playback controls, message speed selection, and an efficient virtualized chat viewer with emote support.",
    "Enforce per-user limits (4 games/topics) and rely on in-memory caching with clear failure modes documented."
  ],
  "features": [
    {
      "name": "Platform Theme Toggle",
      "description": "Allow users to switch between Twitch (purple) and Kick (green) color themes; persist preference in localStorage and restore on page load.",
      "user_flows": [
        "Navigate to / -> Click toggle button on landing -> See the primary color update across all UI elements -> Reload page -> See preferred platform theme restored from localStorage",
        "Navigate to /dashboard -> Click toggle button on dashboard header -> See primary color update across UI elements -> Simulate localStorage write failure -> Reload page -> See default platform theme applied and optional persistence warning"
      ]
    },
    {
      "name": "User Authentication",
      "description": "Sign in and sign up users via Clerk; protect /dashboard and API routes and provide account menu and sign out from the dashboard header.",
      "user_flows": [
        "Navigate to /sign-in -> See Clerk SignIn component -> Enter credentials and submit -> Be redirected to /dashboard -> Click UserButton in dashboard header -> See account menu -> Click Sign out -> Be redirected to /sign-in",
        "Navigate to /dashboard while signed out -> Be redirected to /sign-in -> Enter invalid credentials into Clerk form -> See validation error on /sign-in -> Remain on /sign-in"
      ]
    },
    {
      "name": "Stream Mode Toggle (Game vs Just Chatting)",
      "description": "Toggle dashboard mode between Game and Just Chatting, which swaps input components; switching while streaming is disabled and shows a tooltip.",
      "user_flows": [
        "Navigate to /dashboard -> Click 'Just Chatting' button -> See the input area change to JustChattingInput -> Click 'Juegos' button -> See the input area change to GameInput",
        "Navigate to /dashboard -> Click Play to start the stream -> Attempt to click mode toggle -> See mode toggle button disabled -> See tooltip explaining switching is disabled while stream is active"
      ]
    },
    {
      "name": "Game Input and AI Phrase Generation",
      "description": "Enter a video game name (2–50 chars) to request AI-generated chat phrases via POST /api/generate-phrases; successful generation adds a game chip and caches phrases server-side.",
      "user_flows": [
        "Navigate to /dashboard -> Focus the game text input -> Type a video game name with length between 2 and 50 chars -> Press Enter or click the search button -> POST /api/generate-phrases is called -> See a loading spinner while AI generates phrases -> Receive success response -> See a checkmark icon on success -> See the game tag chip appear in the chips list",
        "Navigate to /dashboard -> Focus the game text input -> Type a 1-character game name -> Press Enter -> See inline validation error preventing submission -> No API call to POST /api/generate-phrases occurs",
        "Navigate to /dashboard -> Enter a valid game name when user already has 4 registered games -> Press Enter -> POST /api/generate-phrases returns limit error -> See limit-reached error message and the new game is not added"
      ]
    },
    {
      "name": "Just Chatting Topic Input and AI Phrase Generation",
      "description": "Provide a topic (2–60 chars) or click one of 8 preset topic chips to generate AI phrases for Just Chatting via POST /api/generate-phrases.",
      "user_flows": [
        "Navigate to /dashboard -> Click 'Just Chatting' mode -> Click a preset topic chip (e.g., 'Música') -> POST /api/generate-phrases is called with mode 'justchatting' -> See loading spinner while generating -> Receive success response -> See checkmark icon and generated phrases available",
        "Navigate to /dashboard -> Click 'Just Chatting' mode -> Type a topic shorter than 2 chars -> Click Submit -> See validation error and no POST /api/generate-phrases call",
        "Navigate to /dashboard -> Click 'Just Chatting' mode -> Type a topic that AI rejects as inappropriate -> Press Enter -> POST /api/generate-phrases returns an error -> See error message explaining topic is invalid or inappropriate"
      ]
    },
    {
      "name": "Message Speed Selector",
      "description": "Choose from four preset message-interval speeds; selection highlights with the platform primary color and buttons are disabled while streaming.",
      "user_flows": [
        "Navigate to /dashboard -> Click the 2-4s speed preset button -> See the selected button highlighted with the primary color -> Click Play to start stream -> Observe messages delivered at the selected interval",
        "Navigate to /dashboard -> Click Play to start stream -> Attempt to click a different speed button while streaming -> See speed buttons disabled -> See tooltip explaining speed cannot be changed while stream is active"
      ]
    },
    {
      "name": "Stream Playback Controls",
      "description": "Play, pause, resume, and stop the simulated chat stream via SSE from GET /api/chat-stream; controls update header labels and manage message list.",
      "user_flows": [
        "Navigate to /dashboard -> Select a game or topic chip -> Click Play -> Open SSE connection to GET /api/chat-stream -> See header label update to 'Streaming: {game}' -> See chat messages appear in the window with realistic timing -> Click Pause -> Close SSE connection without clearing messages -> See header label update to 'En pausa: {game}' -> Click Play -> Reopen SSE connection and resume messages -> Click Stop -> Close SSE and clear all messages -> See header label 'No hay stream activo'",
        "Navigate to /dashboard -> Select a game/topic -> Click Play -> SSE connection drops due to network error -> See stream error state or stopped state -> Click Play to retry -> SSE reconnects or displays retry failure message"
      ]
    },
    {
      "name": "Virtualized Chat Window",
      "description": "Auto-scrolling virtualized list of chat messages implemented with react-virtuoso, showing an empty state, hover highlights, deterministic username colors, timestamps, and a max of 200 messages.",
      "user_flows": [
        "Navigate to /dashboard -> Ensure no active stream -> See empty state SVG and hint text in chat window -> Select a game and Click Play -> See messages appear and auto-scroll to the latest message as stream runs -> Hover over a message row -> See row background highlight -> See username with deterministic color and a timestamp",
        "Navigate to /dashboard -> Start stream and continue until message count exceeds 200 -> Observe oldest messages dropped from the list and virtualized list continues to render and auto-scroll correctly"
      ]
    },
    {
      "name": "Chat Messages with SevenTV Emotes",
      "description": "Messages optionally include SevenTV emote images (50% probability); client fetches https://7tv.io/v3/emote-sets/global and caches emotes per-tab for performance and deduplication.",
      "user_flows": [
        "Navigate to /dashboard -> Start stream -> Client requests https://7tv.io/v3/emote-sets/global -> Receive emote set -> See some messages display SevenTV emote images alongside message text",
        "Navigate to /dashboard -> Start stream -> Client requests https://7tv.io/v3/emote-sets/global -> Network request fails or 7TV returns error -> Messages render without emote images and display fallback text or no image"
      ]
    },
    {
      "name": "User Game Limit Enforcement (4 games)",
      "description": "Enforce a maximum of 4 registered games/topics per user using server-side in-memory storage; expose current list and remaining slots via GET /api/generate-phrases.",
      "user_flows": [
        "Navigate to /dashboard -> Click to add and generate phrases for games until four distinct games are registered -> After each successful POST /api/generate-phrases see a new chip added -> After 4 games see chips list with 4 items and GET /api/generate-phrases returns remaining slots 0",
        "Navigate to /dashboard -> With 4 registered games attempt to add a 5th -> POST /api/generate-phrases returns limit error -> See limit-reached error message and the 5th game is not added",
        "Navigate to /dashboard after a server cold start -> GET /api/generate-phrases returns empty list due to in-memory cache reset -> See previously registered games missing in the UI and prompt to re-register"
      ]
    }
  ],
  "code_summary": {
    "version": "2",
    "type": "frontend",
    "tech_stack": [
      "TypeScript (strict)",
      "Astro 5 (SSR, @astrojs/vercel adapter)",
      "React 19 (client:load / client:only hydration)",
      "Tailwind CSS v4",
      "Clerk (@clerk/astro) – authentication",
      "react-virtuoso – virtualized list",
      "@tabler/icons-react – icons",
      "Groq + Cerebras (server-side AI, failover)",
      "SevenTV API (client-side emote fetch)"
    ],
    "routes": [
      {
        "path": "/",
        "file": "src/pages/index.astro",
        "auth_required": false,
        "description": "Public landing page with platform toggle and CTA (sign-in or go to dashboard)"
      },
      {
        "path": "/sign-in",
        "file": "src/pages/sign-in/index.astro",
        "auth_required": false,
        "description": "Clerk sign-in page; redirects to /dashboard on success"
      },
      {
        "path": "/sign-up",
        "file": "src/pages/sign-up/index.astro",
        "auth_required": false,
        "description": "Clerk sign-up page; redirects to /dashboard on success"
      },
      {
        "path": "/dashboard",
        "file": "src/pages/dashboard.astro",
        "auth_required": true,
        "description": "Main streamer control panel with chat simulator"
      },
      {
        "path": "/dev/chat",
        "file": "src/pages/dev/chat.astro",
        "auth_required": false,
        "description": "Developer sandbox for UI component preview (not linked from app)"
      }
    ],
    "features": [
      {
        "name": "Platform Theme Toggle",
        "description": "Switch between Twitch (purple) and Kick (green) color themes; persisted in localStorage",
        "files": [
          "src/components/PlatformToggle.tsx",
          "src/pages/index.astro",
          "src/pages/dashboard.astro"
        ],
        "entry_route": "/",
        "user_interactions": [
          "Click toggle button on landing or dashboard to switch between Twitch and Kick themes",
          "See the primary color update across all UI elements",
          "Reload page and see the preferred platform theme is restored from localStorage"
        ],
        "api_calls": [],
        "auth_required": false
      },
      {
        "name": "User Authentication",
        "description": "Sign in/sign up via Clerk; protected routes redirect to /sign-in",
        "files": [
          "src/pages/sign-in/index.astro",
          "src/pages/sign-up/index.astro",
          "src/middleware.ts"
        ],
        "entry_route": "/sign-in",
        "user_interactions": [
          "Navigate to /sign-in and see Clerk SignIn component",
          "Enter credentials and submit to sign in",
          "Navigate to /sign-up and create a new account",
          "After sign in/up be redirected to /dashboard",
          "Click UserButton in dashboard header to see account menu and sign out",
          "While signed out try to access /dashboard and be redirected to /sign-in"
        ],
        "api_calls": [],
        "auth_required": false
      },
      {
        "name": "Stream Mode Toggle (Game vs Just Chatting)",
        "description": "Toggle between Game mode and Just Chatting mode on the dashboard",
        "files": [
          "src/components/StreamerDashboard.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Click 'Just Chatting' button to switch to Just Chatting mode",
          "Click 'Juegos' or the game mode button to return to game mode",
          "See the input area change (GameInput vs JustChattingInput)",
          "Observe button is disabled while stream is active with a tooltip"
        ],
        "api_calls": [],
        "auth_required": true
      },
      {
        "name": "Game Input and AI Phrase Generation",
        "description": "Enter a video game name to generate AI chat phrases via API",
        "files": [
          "src/components/GameInput.tsx",
          "src/pages/api/generate-phrases.ts",
          "src/lib/phraseCache.ts",
          "src/lib/ai/serviceManager.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Type a video game name (2-50 chars) in the text input",
          "Press Enter or click the search button to submit",
          "See a loading spinner while AI generates phrases",
          "See a checkmark icon on success",
          "See the game tag chip appear in the chips list",
          "Click an existing game chip to reselect it instantly",
          "See an error if the game name is invalid or not a real game",
          "See an error if the 4-game limit has been reached"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/generate-phrases"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Just Chatting Topic Input and AI Phrase Generation",
        "description": "Enter a conversation topic to generate AI chat phrases for Just Chatting mode",
        "files": [
          "src/components/JustChattingInput.tsx",
          "src/pages/api/generate-phrases.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Switch to Just Chatting mode",
          "Type a topic (2-60 chars) or click one of 8 preset topic chips",
          "See loading spinner while generating",
          "See success checkmark when phrases are ready",
          "See error for invalid or inappropriate topics"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/generate-phrases"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Message Speed Selector",
        "description": "Choose from 4 preset speed intervals between chat messages",
        "files": [
          "src/components/StreamerDashboard.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Click one of the 4 speed preset buttons (4-7s, 2-4s, 1-2s, 0.5-1s)",
          "See the selected button highlighted with the primary color",
          "Observe buttons are disabled while stream is running with a tooltip"
        ],
        "api_calls": [],
        "auth_required": true
      },
      {
        "name": "Stream Playback Controls",
        "description": "Play, pause, and stop the simulated chat stream via SSE",
        "files": [
          "src/components/StreamerDashboard.tsx",
          "src/pages/api/chat-stream.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Select a game/topic and click Play to start the chat stream",
          "See chat messages appear in the window with realistic timing",
          "Click Pause to stop new messages without clearing the chat",
          "Click Play again to resume the stream",
          "Click Stop to end the stream and clear all messages",
          "See the header label update (Streaming, En pausa, No hay stream activo)"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "/api/chat-stream"
          }
        ],
        "auth_required": true
      },
      {
        "name": "Virtualized Chat Window",
        "description": "Auto-scrolling virtualized list of chat messages with empty state",
        "files": [
          "src/components/ChatWindow.tsx",
          "src/components/ChatMessage.tsx"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "See empty state icon and hint text when no messages exist",
          "See messages appear and auto-scroll to latest as stream runs",
          "Hover over a message row to see background highlight",
          "See username colored with deterministic color and timestamp",
          "See SevenTV emote images attached to some messages (50% probability)"
        ],
        "api_calls": [
          {
            "method": "GET",
            "endpoint": "https://7tv.io/v3/emote-sets/global"
          }
        ],
        "auth_required": true
      },
      {
        "name": "User Game Limit Enforcement",
        "description": "Each user can register a maximum of 4 games/topics (in-memory, server-side)",
        "files": [
          "src/lib/phraseCache.ts",
          "src/pages/api/generate-phrases.ts"
        ],
        "entry_route": "/dashboard",
        "user_interactions": [
          "Register 4 different games successfully",
          "Try to add a 5th game and see a limit-reached error message",
          "See a list of currently registered games"
        ],
        "api_calls": [
          {
            "method": "POST",
            "endpoint": "/api/generate-phrases"
          },
          {
            "method": "GET",
            "endpoint": "/api/generate-phrases"
          }
        ],
        "auth_required": true
      }
    ],
    "known_limitations": [
      {
        "issue": "In-memory caches (phraseCache, userGames) reset on server process restart / Vercel cold start",
        "location": "src/lib/phraseCache.ts",
        "impact": "Users lose their registered games and cached phrases on cold starts; no database persistence"
      },
      {
        "issue": "/dev/chat route has no authentication guard",
        "location": "src/pages/dev/chat.astro",
        "impact": "Any user can access the developer sandbox directly via URL"
      },
      {
        "issue": "SevenTV emote cache is browser tab-scoped (module-level variables in ChatMessage.tsx)",
        "location": "src/components/ChatMessage.tsx",
        "impact": "Cache does not persist across page reloads; re-fetches on each session"
      }
    ]
  }
}
