version: "2"
type: frontend
tech_stack:
  - TypeScript (strict)
  - Astro 5 (SSR, @astrojs/vercel adapter)
  - React 19 (client:load / client:only hydration)
  - Tailwind CSS v4
  - Clerk (@clerk/astro) – authentication
  - react-virtuoso – virtualized list
  - "@tabler/icons-react – icons"
  - Groq + Cerebras (server-side AI, failover)
  - SevenTV API (client-side emote fetch)
routes:
  - path: /
    file: src/pages/index.astro
    auth_required: false
    description: Public landing page with platform toggle and CTA (sign-in or go to dashboard)
  - path: /sign-in
    file: src/pages/sign-in/index.astro
    auth_required: false
    description: Clerk sign-in page; redirects to /dashboard on success
  - path: /sign-up
    file: src/pages/sign-up/index.astro
    auth_required: false
    description: Clerk sign-up page; redirects to /dashboard on success
  - path: /dashboard
    file: src/pages/dashboard.astro
    auth_required: true
    description: Main streamer control panel with chat simulator
  - path: /dev/chat
    file: src/pages/dev/chat.astro
    auth_required: false
    description: Developer sandbox for UI component preview (not linked from app)
features:
  - name: Platform Theme Toggle
    description: Switch between Twitch (purple) and Kick (green) color themes; persisted in localStorage
    files:
      - src/components/PlatformToggle.tsx
      - src/pages/index.astro
      - src/pages/dashboard.astro
    entry_route: /
    user_interactions:
      - Click toggle button on landing or dashboard to switch between Twitch and Kick themes
      - See the primary color update across all UI elements
      - Reload page and see the preferred platform theme is restored from localStorage
    api_calls: []
    auth_required: false
  - name: User Authentication
    description: Sign in/sign up via Clerk; protected routes redirect to /sign-in
    files:
      - src/pages/sign-in/index.astro
      - src/pages/sign-up/index.astro
      - src/middleware.ts
    entry_route: /sign-in
    user_interactions:
      - Navigate to /sign-in and see Clerk SignIn component
      - Enter credentials and submit to sign in
      - Navigate to /sign-up and create a new account
      - After sign in/up be redirected to /dashboard
      - Click UserButton in dashboard header to see account menu and sign out
      - While signed out try to access /dashboard and be redirected to /sign-in
    api_calls: []
    auth_required: false
  - name: Stream Mode Toggle (Game vs Just Chatting)
    description: Toggle between Game mode and Just Chatting mode on the dashboard
    files:
      - src/components/StreamerDashboard.tsx
    entry_route: /dashboard
    user_interactions:
      - Click 'Just Chatting' button to switch to Just Chatting mode
      - Click 'Juegos' or the game mode button to return to game mode
      - See the input area change (GameInput vs JustChattingInput)
      - Observe button is disabled while stream is active with a tooltip
    api_calls: []
    auth_required: true
  - name: Game Input and AI Phrase Generation
    description: Enter a video game name to generate AI chat phrases via API
    files:
      - src/components/GameInput.tsx
      - src/pages/api/generate-phrases.ts
      - src/lib/phraseCache.ts
      - src/lib/ai/serviceManager.ts
    entry_route: /dashboard
    user_interactions:
      - Type a video game name (2-50 chars) in the text input
      - Press Enter or click the search button to submit
      - See a loading spinner while AI generates phrases
      - See a checkmark icon on success
      - See the game tag chip appear in the chips list
      - Click an existing game chip to reselect it instantly
      - See an error if the game name is invalid or not a real game
      - See an error if the 4-game limit has been reached
    api_calls:
      - method: POST
        endpoint: /api/generate-phrases
    auth_required: true
  - name: Just Chatting Topic Input and AI Phrase Generation
    description: Enter a conversation topic to generate AI chat phrases for Just Chatting mode
    files:
      - src/components/JustChattingInput.tsx
      - src/pages/api/generate-phrases.ts
    entry_route: /dashboard
    user_interactions:
      - Switch to Just Chatting mode
      - Type a topic (2-60 chars) or click one of 8 preset topic chips
      - See loading spinner while generating
      - See success checkmark when phrases are ready
      - See error for invalid or inappropriate topics
    api_calls:
      - method: POST
        endpoint: /api/generate-phrases
    auth_required: true
  - name: Message Speed Selector
    description: Choose from 4 preset speed intervals between chat messages
    files:
      - src/components/StreamerDashboard.tsx
    entry_route: /dashboard
    user_interactions:
      - Click one of the 4 speed preset buttons (4-7s, 2-4s, 1-2s, 0.5-1s)
      - See the selected button highlighted with the primary color
      - Observe buttons are disabled while stream is running with a tooltip
    api_calls: []
    auth_required: true
  - name: Stream Playback Controls
    description: Play, pause, and stop the simulated chat stream via SSE
    files:
      - src/components/StreamerDashboard.tsx
      - src/pages/api/chat-stream.ts
    entry_route: /dashboard
    user_interactions:
      - Select a game/topic and click Play to start the chat stream
      - See chat messages appear in the window with realistic timing
      - Click Pause to stop new messages without clearing the chat
      - Click Play again to resume the stream
      - Click Stop to end the stream and clear all messages
      - See the header label update (Streaming, En pausa, No hay stream activo)
    api_calls:
      - method: GET
        endpoint: /api/chat-stream
    auth_required: true
  - name: Virtualized Chat Window
    description: Auto-scrolling virtualized list of chat messages with empty state
    files:
      - src/components/ChatWindow.tsx
      - src/components/ChatMessage.tsx
    entry_route: /dashboard
    user_interactions:
      - See empty state icon and hint text when no messages exist
      - See messages appear and auto-scroll to latest as stream runs
      - Hover over a message row to see background highlight
      - See username colored with deterministic color and timestamp
      - See SevenTV emote images attached to some messages (50% probability)
    api_calls:
      - method: GET
        endpoint: https://7tv.io/v3/emote-sets/global
    auth_required: true
  - name: User Game Limit Enforcement
    description: Each user can register a maximum of 4 games/topics (in-memory, server-side)
    files:
      - src/lib/phraseCache.ts
      - src/pages/api/generate-phrases.ts
    entry_route: /dashboard
    user_interactions:
      - Register 4 different games successfully
      - Try to add a 5th game and see a limit-reached error message
      - See a list of currently registered games
    api_calls:
      - method: POST
        endpoint: /api/generate-phrases
      - method: GET
        endpoint: /api/generate-phrases
    auth_required: true
known_limitations:
  - issue: In-memory caches (phraseCache, userGames) reset on server process restart / Vercel cold start
    location: src/lib/phraseCache.ts
    impact: Users lose their registered games and cached phrases on cold starts; no database persistence
  - issue: /dev/chat route has no authentication guard
    location: src/pages/dev/chat.astro
    impact: Any user can access the developer sandbox directly via URL
  - issue: SevenTV emote cache is browser tab-scoped (module-level variables in ChatMessage.tsx)
    location: src/components/ChatMessage.tsx
    impact: Cache does not persist across page reloads; re-fetches on each session
